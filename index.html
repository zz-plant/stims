<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stim Webtoys Library</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="assets/css/base.css" />
    <link rel="stylesheet" href="assets/css/index.css" />
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@graph": [
          {
            "@type": "Organization",
            "@id": "https://no.toil.fyi/#organization",
            "name": "Stim Lab",
            "url": "https://no.toil.fyi/",
            "sameAs": ["https://github.com/zz-plant/stims"]
          },
          {
            "@type": "WebSite",
            "@id": "https://no.toil.fyi/#website",
            "url": "https://no.toil.fyi/",
            "name": "Stim Webtoys Library",
            "publisher": { "@id": "https://no.toil.fyi/#organization" },
            "inLanguage": "en"
          },
          {
            "@type": "WebPage",
            "@id": "https://no.toil.fyi/#webpage",
            "url": "https://no.toil.fyi/",
            "name": "Stim Webtoys Library",
            "headline": "Feel-first visuals that breathe with your audio.",
            "description": "Explore audio, color, and motion without setup. Every stim opens fast, responds to mic and touch, and comes with sensible defaults that keep you in flow.",
            "isPartOf": { "@id": "https://no.toil.fyi/#website" },
            "publisher": { "@id": "https://no.toil.fyi/#organization" },
            "inLanguage": "en"
          }
        ]
      }
    </script>
    <script>
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'light') {
        document.documentElement.classList.add('light');
      }
    </script>
  </head>
  <body>
    <div class="content">
      <nav class="top-nav">
        <div class="brand">
          <span class="brand-mark"></span>
          <div class="brand-copy">
            <p class="eyebrow">Stim Lab</p>
            <p class="brand-title">Webtoy Library âœ¦</p>
          </div>
        </div>
        <div class="nav-actions">
          <a class="nav-link" href="#toy-list">Library</a>
          <a
            class="nav-link"
            href="https://github.com/zz-plant/stims"
            target="_blank"
            rel="noopener noreferrer"
            >GitHub</a
          >
          <button
            id="theme-toggle"
            class="theme-toggle"
            aria-pressed="false"
            aria-label="Switch to dark mode"
          >
            Dark Mode
          </button>
        </div>
      </nav>

      <header class="hero">
        <div class="hero-grid">
          <div class="hero-copy">
            <p class="eyebrow">
              Open-source stims â€¢ Quick to try â€¢ No accounts
            </p>
            <h1>Feel-first visuals that breathe with your audio.</h1>
            <p class="tagline">
              Explore audio, color, and motion without setup. Every stim opens
              fast, responds to mic and touch, and comes with sensible defaults
              that keep you in flow. When you launch a toy, weâ€™ll ask for
              microphone access so visuals can react to your sound.
            </p>
            <div class="signal-grid" role="list">
              <div class="signal-card" role="listitem">
                <p class="signal-label">Cinematic by default</p>
                <p class="signal-value">
                  Layered gradients, softened edges, and light/dark palettes
                  that respect your theme.
                </p>
              </div>
              <div class="signal-card" role="listitem">
                <p class="signal-label">Responsive everywhere</p>
                <p class="signal-value">
                  Keyboard, touch, and reduced-motion aware so focus stays on
                  the sensation, not the setup.
                </p>
              </div>
            </div>
            <div class="readiness-panel" role="status" aria-live="polite">
              <div class="readiness-header">
                <p class="eyebrow">Interaction readiness</p>
                <p class="readiness-title">Quick pulse before you launch</p>
                <p class="readiness-subtitle">
                  We check capabilities without requesting permission so you
                  know what to expect.
                </p>
              </div>
              <ul class="readiness-list">
                <li class="readiness-item">
                  <div class="readiness-label">
                    <span
                      class="readiness-dot"
                      data-status-dot="mic"
                      aria-hidden="true"
                    ></span>
                    <span class="readiness-name">Microphone input</span>
                  </div>
                  <p class="readiness-note" data-status-note="mic">
                    Detecting audio supportâ€¦
                  </p>
                </li>
                <li class="readiness-item">
                  <div class="readiness-label">
                    <span
                      class="readiness-dot"
                      data-status-dot="motion"
                      aria-hidden="true"
                    ></span>
                    <span class="readiness-name">Motion controls</span>
                  </div>
                  <p class="readiness-note" data-status-note="motion">
                    Checking for device motionâ€¦
                  </p>
                </li>
                <li class="readiness-item">
                  <div class="readiness-label">
                    <span
                      class="readiness-dot"
                      data-status-dot="reduced"
                      aria-hidden="true"
                    ></span>
                    <span class="readiness-name"
                      >Reduced motion preference</span
                    >
                  </div>
                  <p class="readiness-note" data-status-note="reduced">
                    Reading your animation comfort settingsâ€¦
                  </p>
                </li>
              </ul>
            </div>
            <div class="cta-row">
              <a
                href="toy.html?toy=holy"
                class="cta-button primary"
                data-quickstart-slug="holy"
              >
                Start with Halo Flow
              </a>
              <a href="#toy-list" class="cta-button ghost">Browse library</a>
              <a
                href="https://github.com/zz-plant/stims"
                target="_blank"
                rel="noopener noreferrer"
                class="cta-button ghost"
                >View the code</a
              >
            </div>
            <p class="cta-helper">
              No installs or accounts. Enable your mic when prompted to see the
              visuals react. Code and contribution notes live on GitHub.
            </p>
            <div class="repo-status" data-repo-status aria-live="polite">
              <div class="repo-status__header">
                <p class="eyebrow">Project health</p>
                <p class="repo-status__title">GitHub status</p>
                <p class="repo-status__description">
                  Latest stats for
                  <span class="repo-status__repo-name">zz-plant/stims</span>
                  with live stars and recent activity.
                </p>
              </div>
              <dl class="repo-status__metrics">
                <div class="repo-status__metric">
                  <dt>Stars</dt>
                  <dd data-star-count aria-label="Stargazers">â€”</dd>
                </div>
                <div class="repo-status__metric">
                  <dt>Last push</dt>
                  <dd data-last-commit aria-label="Last commit date">â€”</dd>
                </div>
              </dl>
              <p
                class="repo-status__message"
                data-status-fallback
                hidden
                role="status"
                aria-live="polite"
              >
                Loading GitHub statsâ€¦
              </p>
            </div>
            <div class="hero-highlights">
              <div class="highlight-chip">
                <span aria-hidden="true">ðŸª©</span> Audio-reactive scenes and
                tactile controls.
              </div>
              <div class="highlight-chip">
                <span aria-hidden="true">âš¡</span> Zero-install links that open
                instantly.
              </div>
              <div class="highlight-chip">
                <span aria-hidden="true">ðŸŒ—</span> Light/dark mode remembers
                your choice.
              </div>
              <div class="highlight-chip">
                <span aria-hidden="true">ðŸ§­</span> Curated paths help you find a
                vibe fast.
              </div>
            </div>
          </div>
          <div class="hero-visual" aria-hidden="true">
            <div class="orbital">
              <span class="orbital__ring orbital__ring--outer"></span>
              <span class="orbital__ring orbital__ring--inner"></span>
              <span class="orbital__pulse"></span>
              <span class="orbital__core"></span>
            </div>
            <div class="hero-callouts">
              <div class="callout-card">
                <p class="callout-title">Built for instant focus</p>
                <p class="callout-copy">
                  Clean typography, generous spacing, and animated gradients
                  keep the landing experience calm while you choose a stim.
                </p>
              </div>
              <div class="callout-row">
                <span class="pill pill--accent">Live audio reactive</span>
                <span class="pill pill--soft">Touch + keyboard friendly</span>
                <span class="pill pill--contrast">WebGPU ready toys</span>
              </div>
            </div>
          </div>
        </div>
      </header>

      <section class="feature-bands">
        <div class="section-heading">
          <p class="eyebrow">Design refresh</p>
          <h2>Curated paths make discovery calmer</h2>
          <p class="section-description">
            We rebuilt the landing layout with layered glass, new gradients, and
            cushioned cards. Spotlights and sound-first tips now sit above the
            full library so you can either follow a vibe or dive straight into
            every toy.
          </p>
        </div>
        <div class="feature-grid">
          <article class="feature-card">
            <div class="feature-icon" aria-hidden="true">ðŸŒˆ</div>
            <div class="feature-body">
              <h3>Color-first spotlights</h3>
              <p>
                New highlight cards pair atmospheric gradients with clear
                descriptions so you can pick a palette that matches your mood.
              </p>
              <p class="feature-meta">
                Glassy borders, subtle glow, and rounded corners that feel
                tactile.
              </p>
            </div>
          </article>
          <article class="feature-card">
            <div class="feature-icon" aria-hidden="true">ðŸŽ§</div>
            <div class="feature-body">
              <h3>Audio-aware guidance</h3>
              <p>
                Callouts explain how to start with microphone input, demos, or
                device motion without ever feeling technical.
              </p>
              <p class="feature-meta">
                Lightweight help text with improved readability on both themes.
              </p>
            </div>
          </article>
          <article class="feature-card">
            <div class="feature-icon" aria-hidden="true">ðŸ§­</div>
            <div class="feature-body">
              <h3>Wayfinding that hugs the grid</h3>
              <p>
                New section spacing, pill-shaped highlights, and soft dividers
                keep the experience airy even with dozens of entries.
              </p>
              <p class="feature-meta">
                Library search and cards inherit the refreshed styling
                automatically.
              </p>
            </div>
          </article>
        </div>
      </section>

      <section class="library">
        <div class="section-heading">
          <p class="eyebrow">Library</p>
          <h2>Browse every stim</h2>
          <p class="section-description">
            Tap a card to open it. Standalone stims like Clay, Geom, Legible,
            and Lights sit alongside the module-based set so everything is easy
            to reach.
          </p>
          <div class="library-search">
            <label class="sr-only" for="toy-search">Search the library</label>
            <div class="search-field">
              <input
                id="toy-search"
                type="search"
                name="toy-search"
                placeholder="Search by name, tags, moods, or capabilities (try: calm, motion, demo audio)"
                autocomplete="off"
                inputmode="search"
              />
              <span aria-hidden="true" class="search-field__hint"
                >Search name, tags, mood, mic/motion/demo audio</span
              >
            </div>
            <div class="search-meta">
              <p
                class="search-meta__results"
                data-search-results
                role="status"
                aria-live="polite"
              >
                Loading libraryâ€¦
              </p>
            </div>
          </div>
        </div>
        <main id="toy-list" class="webtoy-container"></main>
      </section>

      <footer>
        <div class="footer-actions">
          <p>
            Curious about how these work?
            <a
              href="https://github.com/zz-plant/stims"
              target="_blank"
              rel="noopener noreferrer"
            >
              Check out our open-source project.
            </a>
          </p>
          <div class="cta-row footer-cta-row">
            <a
              href="https://github.com/zz-plant/stims/issues/new/choose"
              target="_blank"
              rel="noopener noreferrer"
              class="cta-button ghost"
              >Report an issue</a
            >
            <a
              href="https://github.com/zz-plant/stims/blob/main/CONTRIBUTING.md"
              target="_blank"
              rel="noopener noreferrer"
              class="cta-button ghost"
              >Contribute</a
            >
          </div>
          <p class="cta-helper footer-helper">
            GitHub links include issue forms plus the contribution guide if
            you're preparing a pull request.
          </p>
        </div>
      </footer>
    </div>

    <script>
      window.addEventListener('DOMContentLoaded', () => {
        const list = document.getElementById('toy-list');
        if (!list || list.childElementCount > 0) return;

        const search = document.getElementById('toy-search');
        const searchResults = document.querySelector('[data-search-results]');
        let cachedQuery = '';
        let allToys = [];

        const updateResultsMeta = (count, total, query = '') => {
          if (!(searchResults instanceof HTMLElement)) return;
          const countLabel = `${count} ${count === 1 ? 'match' : 'matches'}`;
          const totalLabel = `${total} ${total === 1 ? 'stim' : 'stims'}`;
          searchResults.textContent = query
            ? `${countLabel} for â€œ${query}â€`
            : `Showing all ${totalLabel}`;
        };

        const renderEmptyState = () => {
          const empty = document.createElement('div');
          empty.className = 'empty-state';
          const message = document.createElement('p');
          message.className = 'empty-state__message';
          message.textContent = 'No stims match your search.';

          const reset = document.createElement('button');
          reset.type = 'button';
          reset.className = 'cta-button ghost';
          reset.textContent = 'Clear search';
          reset.addEventListener('click', () => {
            if (search instanceof HTMLInputElement) {
              search.value = '';
              cachedQuery = '';
            }
            renderCards(allToys, '');
          });

          empty.append(message, reset);
          list.appendChild(empty);
        };

        const renderCards = (toys, query = '') => {
          list.innerHTML = '';
          updateResultsMeta(toys.length, allToys.length, query || cachedQuery);

          if (toys.length === 0) {
            renderEmptyState();
            return;
          }

          toys.forEach((toy) => {
            const href =
              toy.type === 'page'
                ? toy.module
                : `toy.html?toy=${encodeURIComponent(toy.slug)}`;

            const card = document.createElement('a');
            card.className = 'webtoy-card';
            card.href = href;
            card.setAttribute('data-toy-fallback', 'true');

            const title = document.createElement('h3');
            title.textContent = toy.title;

            const desc = document.createElement('p');
            desc.textContent = toy.description;

            card.append(title, desc);

            const badgeRow = document.createElement('div');
            badgeRow.className = 'webtoy-card-meta';

            const badges = [];

            if (toy.requiresWebGPU) {
              badges.push({
                label: 'WebGPU',
                title: 'Requires WebGPU to run.',
              });
            }

            if (toy.capabilities?.microphone) {
              badges.push({
                label: 'Microphone',
                title: 'Uses live microphone input for audio.',
              });
            }

            if (toy.capabilities?.demoAudio) {
              badges.push({
                label: 'Demo audio',
                title: 'Includes a demo track if you skip the mic.',
              });
            }

            if (toy.capabilities?.motion) {
              badges.push({
                label: 'Motion',
                title: 'Responds to device motion or tilt.',
              });
            }

            if (badges.length > 0) {
              badges.forEach((badgeData) => {
                const badge = document.createElement('span');
                badge.className = 'capability-badge';
                badge.textContent = badgeData.label;
                badge.title = badgeData.title;
                badgeRow.appendChild(badge);
              });

              card.appendChild(badgeRow);
            }

            list.appendChild(card);
          });
        };

        fetch('./toys.json')
          .then((response) => (response.ok ? response.json() : null))
          .then((toys) => {
            if (!toys || list.childElementCount > 0) return;

            allToys = toys;
            renderCards(allToys);

            if (search instanceof HTMLInputElement) {
              search.addEventListener('input', () => {
                const query = search.value.toLowerCase().trim();
                cachedQuery = query;

                if (!query) {
                  renderCards(allToys);
                  return;
                }

                const filtered = allToys.filter((toy) => {
                  const capabilityTerms = Object.entries(toy.capabilities || {})
                    .filter(([, enabled]) => !!enabled)
                    .map(([key]) => key.toLowerCase());

                  const haystack = [
                    toy.title,
                    toy.slug,
                    toy.description,
                    ...(toy.tags ?? []),
                    ...(toy.moods ?? []),
                    ...capabilityTerms,
                    toy.requiresWebGPU ? 'webgpu' : '',
                  ]
                    .filter(Boolean)
                    .join(' ')
                    .toLowerCase();

                  return haystack.includes(query);
                });

                renderCards(filtered, query);
              });
            }
          })
          .catch((error) => {
            console.error('Unable to render library fallback', error);
          });

        const readinessDots = {
          mic: document.querySelector('[data-status-dot="mic"]'),
          motion: document.querySelector('[data-status-dot="motion"]'),
          reduced: document.querySelector('[data-status-dot="reduced"]'),
        };

        const readinessNotes = {
          mic: document.querySelector('[data-status-note="mic"]'),
          motion: document.querySelector('[data-status-note="motion"]'),
          reduced: document.querySelector('[data-status-note="reduced"]'),
        };

        const setReadinessState = (key, state, message) => {
          const dot = readinessDots[key];
          const note = readinessNotes[key];
          if (dot instanceof HTMLElement) {
            dot.dataset.status = state;
          }
          if (note instanceof HTMLElement) {
            note.textContent = message;
          }
        };

        const hasMediaDevices = () => !!navigator.mediaDevices?.getUserMedia;
        const hasMotionSensors = () =>
          'DeviceMotionEvent' in window || 'LinearAccelerationSensor' in window;

        const updateMicStatus = () => {
          if (hasMediaDevices()) {
            setReadinessState(
              'mic',
              'ready',
              'Live audio available â€” you can grant mic access when a toy asks.'
            );
          } else {
            setReadinessState(
              'mic',
              'warn',
              'No microphone detected. Use demo audio or plug in a mic before starting.'
            );
          }
        };

        const updateMotionStatus = () => {
          if (hasMotionSensors()) {
            setReadinessState(
              'motion',
              'ready',
              'Motion/tilt supported â€” toys will adapt if permission is granted.'
            );
          } else {
            setReadinessState(
              'motion',
              'warn',
              'Motion controls unavailable or locked down. Try on mobile or enable motion access.'
            );
          }
        };

        const updateReducedMotionStatus = () => {
          const mediaQuery = window.matchMedia(
            '(prefers-reduced-motion: reduce)'
          );

          const applyPreference = (query) => {
            if (query.matches) {
              setReadinessState(
                'reduced',
                'ready',
                'Animations will soften because you prefer reduced motion.'
              );
            } else {
              setReadinessState(
                'reduced',
                'ready',
                'Full motion is enabled. Toggle reduced motion in your OS to soften effects.'
              );
            }
          };

          applyPreference(mediaQuery);
          mediaQuery.addEventListener('change', applyPreference);
        };

        updateMicStatus();
        updateMotionStatus();
        updateReducedMotionStatus();
      });
    </script>
    <script type="module" src="assets/js/main.js"></script>
  </body>
</html>
