# Page-level specifications

Detailed, testable requirements for the two primary shells—`index.html` (library landing) and `toy.html` (shared toy entry)—so contributors can develop against clear section-level expectations for data, layout, and accessibility.

## Library landing (`index.html`)

| Section                            | Expected data and state                                                                                                                                                                                          | Layout and interaction expectations                                                                                                                                                     | Accessibility and status behaviors                                                                                                                                                                |
| ---------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Global frame**                   | Loads shared styles from `assets/css/base.css` and `assets/css/index.css`. Uses `lang="en"` and preserves the saved theme from `localStorage` before paint.                                                      | Content sits inside `.content` with a stacked flow: nav → hero → feature bands → library grid → footer.                                                                                 | Theme toggle must keep `aria-pressed` and `aria-label` in sync with the active theme; page text should remain readable in light and dark modes.                                                   |
| **Top nav**                        | Static links to the library anchor and GitHub repo; theme toggle initialized by `createLibraryView({ enableDarkModeToggle: true })`.                                                                             | Nav shows brand lockup at the start, links on the right, and the toggle as a clear button. Brand mark remains visible without external assets.                                          | Links open in the same tab (library anchor) or a new tab (GitHub with `rel="noopener noreferrer"`). Toggle must be reachable via keyboard and announce state changes.                             |
| **Hero + CTA row**                 | Copy stays inline in the markup; the `data-quickstart-slug` attribute sets the default toy for the primary CTA and is passed to `loadToy` if JS is active.                                                       | Hero splits into copy + orbital art on wide screens; CTA row emphasizes one primary quickstart and one secondary surprise action, while additional paths remain in supporting text links. Helper text under the CTAs clarifies microphone expectations and mentions demo audio availability. | CTA buttons retain visible focus, and the helper text remains readable in both themes. Modified clicks on the quickstart CTA should fall back to native navigation (no JS interception).          |
| **Compatibility callout**          | Optional inline callout summarizes device/browser requirements and links to troubleshooting details (WebGL/WebGPU availability, mic permissions, demo audio, and fallback toy list).                             | Callout sits beneath the hero CTAs and uses a compact, single-column layout that wraps on narrow screens.                                                                              | Callout uses clear, scannable text and avoids color-only signals; links are keyboard reachable and announce purpose.                                                                          |
| **Repo status widget**             | Pulls live data from GitHub’s repo API via `initRepoStatusWidget` with 15-minute sessionStorage caching; shows cached data immediately when available.                                                           | Widget renders eyebrow/title/description plus a definition list for stars and last push. Status copy sits beneath as a single-line message.                                             | The fallback message uses `aria-live="polite"` to announce loading/rate-limit states. Metrics default to an em dash when data is unavailable.                                                     |
| **Feature bands**                  | Static text-only cards (no async data) describing discovery improvements.                                                                                                                                        | Three `.feature-card` articles with icon + body + meta; cards wrap on narrow screens while keeping consistent padding and spacing.                                                      | Icons are decorative (`aria-hidden="true"`); headings remain in the normal reading order for screen readers.                                                                                      |
| **Library search header**          | Input id `toy-search` wired to the library view and to the no-JS fallback renderer. Status line `[data-search-results]` shows counts (e.g., `"Showing all 21 stims"` or `"3 matches for “calm”"`).               | Search field sits above the grid with placeholder + hint text; status line aligns with the search controls.                                                                             | Search label uses `.sr-only` to expose name to screen readers; status line is `role="status"` with `aria-live="polite"` so result counts announce automatically.                                  |
| **Library grid (primary JS path)** | Powered by `createLibraryView` with data from `assets/data/toys.json`; renders cards as `<a>` elements unless configured otherwise.                                                                             | Cards include icon, title, description, and badges for WebGPU plus capability badges (microphone, motion, demo audio) when present; clicking loads the toy via SPA routing for modules or navigates directly for standalone pages. | Cards are keyboard-activatable via Enter/Space when keyboard handlers are enabled; capability badges show short text labels (for example, “Mic”, “Motion”, “Demo audio”) with `title` or `aria-label` clarity, while the WebGPU badge keeps `role="status"` and warning styling when `navigator.gpu` is absent. |
| **Library grid (no-JS fallback)**  | If `#toy-list` is empty after DOMContentLoaded, the inline script fetches `./toys.json` and renders badges for `requiresWebGPU`, `capabilities.microphone`, `capabilities.demoAudio`, and `capabilities.motion`. | Cards render as anchors with heading + paragraph + optional badge row. Empty results show an inline empty state and a “Clear search” button that repaints the full list.                | Badge text is plain text with `title` tooltips; the empty state copy plus the reset button must be keyboard reachable. The results status continues to announce counts during fallback rendering. |
| **Search filtering**               | Query matches against title, slug, description, tags, moods, capability terms (for example “mic”, “demo audio”, “motion”), and the WebGPU marker (via `webgpu`). Search hint/placeholder copy must only promise terms that are indexed in the `library-view` haystack. | Filtering happens on input; clearing the field restores the full list. The empty state appears only when no matches remain.                                                             | Status line updates with match counts; empty state uses clear, concise text without relying on color alone.                                                                                       |
| **Footer**                         | Static GitHub issue/contribution links plus helper copy.                                                                                                                                                         | Footer actions reuse the CTA button style and sit above helper text; links open in new tabs with `rel="noopener noreferrer"`.                                                           | Footer links preserve focus styles; helper text should remain readable in both themes.                                                                                                            |

## Toy entry shell (`toy.html`)

| Section                     | Expected data and state                                                                                                                                                                                                                                | Layout and interaction expectations                                                                                                                                                  | Accessibility and status behaviors                                                                                                                                                                                                                                 |
| --------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Back link + shell**       | Inline anchor to `index.html` sits before the control panel. Shared styles from `assets/css/base.css` and `assets/css/index.css` apply.                                                                                                                | Back link remains visible on load; control panel fills the remaining viewport width with cushioned spacing.                                                                          | Back link uses native focus styles and clear text. Overall document keeps `lang="en"`.                                                                                                                                                                             |
| **Audio control panel**     | Three rows with fixed labels: “Use microphone” triggers live input; “Use demo audio” loads the built-in track; “YouTube audio” includes a URL field, load button, and a CTA to capture tab audio. `#audio-status` holds runtime messages. When mic access is blocked or unavailable, the demo audio CTA is emphasized by default and the status copy explains the fallback.              | Buttons share CTA styling; quick-start mic/demo actions are presented as step 1, with tab/YouTube grouped under an optional step-2 advanced section. The YouTube row stacks input, load button, and player preview without overflow. Controls remain readable on narrow screens. Provide immediate pressed feedback and ensure controls meet the 44×44px touch target minimum with `touch-action: manipulation`. If the panel scrolls, it must use `overscroll-behavior: contain`. On touch-capable devices, contextual gesture hints can appear after audio starts and fade once interaction begins.                               | Status element uses `role="status"` and is hidden until populated. All inputs/buttons must be keyboard-activatable and preserve visible focus.                                                                                                                     |
| **Quality controls**        | Optional quality controls expose presets (e.g., default, high detail, low motion) and a pixel ratio cap that persists in local storage and is read before the renderer starts. Preset labels briefly explain the tradeoff (performance vs. fidelity).                                 | Controls appear as a compact panel below the audio controls, using toggles and a slider that fit within the control panel width.                                                      | All toggles are keyboard reachable with clear focus treatment; labels describe the performance impact (e.g., “lower GPU load”).                                                                                                                               |
| **Capability preflight**    | `attachCapabilityPreflight` mounts a capability check UI on `document.body`, calling `startToyPage` when `result.canProceed` is true and showing an error otherwise. Retry reuses the same callback and a back-to-library action is available.                                                   | Preflight runs immediately on load, before microphone prompts. When successful, it updates the status region to “Loading toy…” and starts the loader once.                           | Preflight messages announce via the status region. If capabilities are insufficient, the failure message stays visible and readable until the user retries or navigates back.                                                                                                        |
| **Microphone/demo flow**    | `setupMicrophonePermissionFlow` wires the two CTAs to `window.startAudio`/`window.startAudioFallback` created by `startToyPage`. Mic path throws if the starter is missing; demo audio falls back to the primary starter if no fallback is registered. | Clicking either CTA starts the loader (once), then calls the relevant starter. Success callback hides the mic CTA and the demo CTA when granted. Errors bubble to the status region. | Buttons expose accessible text for both options. Status updates remain concise; the status element is announced via `role="status"`. CTA visibility updates must not break focus order (focus moves to body/root when a hidden button would otherwise keep focus). |
| **YouTube audio flow**      | The YouTube row loads a video via an embedded player and uses `navigator.mediaDevices.getDisplayMedia` to capture tab audio, passing the stream to `window.startAudio`.                                                                              | Loading a URL reveals the player. Starting YouTube audio prompts for tab capture and shares the stream with the toy. Success hides the mic/demo CTAs and disables the YouTube CTA.   | The YouTube CTA remains keyboard accessible. Status messages guide users to share the current tab and enable audio sharing.                                                                                                                                        |
| **Post-start expectations** | After a successful start, the toy loader owns the remaining viewport; control panel stays present but hides the redundant CTA(s).                                                                                                                      | No additional popovers are introduced by the shell; interaction shifts entirely to the loaded toy and its settings panel.                                                            | Any subsequent status updates (e.g., renderer errors) continue to reuse the `#audio-status` region so screen readers receive updates without scanning the canvas.                                                                                                  |
